<!-- Modal de Cadastro -->
<div id="modal" class="modal fade" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Cadastro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"
                    id="btnFechar"></button>
            </div>

            <form class="bg-white p-4" method="POST" action="/cadastro">
                <!-- Barra de Progresso -->
                <div class="progress mb-3">
                    <div class="progress-bar barra" role="progressbar" id="progressBar"></div>
                </div>
                <!-- Abas -->
                <ul class="nav nav-pills mb-3 justify-content-between" id="pills-tab" role="tablist">
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <a class="nav-link active" id="pills-tab1-tab" data-bs-toggle="pill" href="#pills-tab1"
                            role="tab" aria-controls="pills-tab1" aria-selected="true" onclick="return false">1.
                            Informações</a>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <a class="nav-link" id="pills-tab2-tab" data-bs-toggle="pill" href="#pills-tab2" role="tab"
                            aria-controls="pills-tab2" aria-selected="false" onclick="return false">2. Endereço</a>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <a class="nav-link" id="pills-tab3-tab" data-bs-toggle="pill" href="#pills-tab3" role="tab"
                            aria-controls="pills-tab3" aria-selected="false" onclick="return false">3. Acesso</a>
                    </li>
                </ul>

                <div class="tab-content" id="pills-tabContent">
                    <!-- Aba 1 -->
                    <div class="tab-pane fade show active" id="pills-tab1" role="tabpanel"
                        aria-labelledby="pills-tab1-tab">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cpf_cnpj" class="form-label">CPF ou CNPJ</label>
                                <input type="text" class="form-control" id="cpf_cnpj" name="cpf_cnpj" required
                                    oninput="atualizarCampoDocumento(this)" onblur="consultarDocumento()">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nome" class="form-label">Nome ou Razão Social</label>
                                <input type="text" class="form-control" id="nome" name="nome" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="contato" class="form-label">Telefone</label>
                                <input type="text" class="form-control" id="contato" name="contato" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="tipo" class="form-label">Tipo de Usuário</label>
                                <select class="form-select" id="tipo" name="tipo" required>
                                    <option value="" hidden="true">Selecione</option>
                                    <option value="F">Fornecedor de Energia</option>
                                    <option value="C">Consumidor</option>
                                </select>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button style="background-color: #003366;" type="button" class="btn btn-secondary"
                                onclick="irParaAba(1)">Próximo</button>
                        </div>
                    </div>

                    <!-- Aba 2 -->
                    <div class="tab-pane fade" id="pills-tab2" role="tabpanel" aria-labelledby="pills-tab2-tab">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="cep" class="form-label">CEP</label>
                                <input type="text" class="form-control" id="cep" name="cep" onkeyup="buscarEndereco()"
                                    required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="rua" class="form-label">Rua</label>
                                <input type="text" class="form-control" id="rua" name="rua" required>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="numero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="numero" name="numero" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="bairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="bairro" name="bairro" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="cidade" name="cidade" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="estado" class="form-label">Estado</label>
                                <input type="text" class="form-control" id="estado" name="estado" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="pais" class="form-label">País</label>
                                <input type="text" class="form-control" id="pais" name="pais" required>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="irParaAba(0)">Voltar</button>
                            <button style="background-color: #003366;" type="button" class="btn btn-secondary"
                                onclick="irParaAba(2)">Próximo</button>
                        </div>
                    </div>

                    <!-- Aba 3 -->
                    <div class="tab-pane fade" id="pills-tab3" role="tabpanel" aria-labelledby="pills-tab3-tab">
                        <div class="mb-3">
                            <label for="cadastroEmail" class="form-label">Login</label>
                            <input type="email" class="form-control" id="cadastroEmail" name="cadastroEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="cadastroSenha" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="cadastroSenha" name="cadastroSenha"
                                required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmar_senha" class="form-label">Confirmar Senha</label>
                            <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha"
                                required>
                        </div>
                        <p class="mt-2 small text-muted">
                            Ao continuar, você concorda com nossos
                            <a href="/termos" target="_blank">Política de Privacidade</a> e
                            <a href="/cookies" target="_blank">Política de Cookies</a>.
                        </p>
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="irParaAba(1)">Voltar</button>
                            <button style="background-color: #003366;" type="submit"
                                class="btn btn-secondary">Cadastrar</button>
                        </div>
                    </div>

                    {{#if alertaCadastro}}
                    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                    <script>
                        Swal.fire({
                            icon: 'error',
                            title: 'Usuário já cadastrado',
                            text: '{{alertaCadastro.campo}} já existe: {{alertaCadastro.valor}}',
                            confirmButtonText: 'OK'
                        });
                    </script>
                    {{/if}}

                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById('modal');
        const form = modal.querySelector("form");

        modal.addEventListener('hidden.bs.modal', function () {
            form.reset();
            const primeiraAba = new bootstrap.Tab(document.querySelector('#pills-tab1-tab'));
            primeiraAba.show();
            document.getElementById("progressBar").style.width = "0%";
        });

        form.addEventListener("submit", function (e) {
            e.preventDefault();

            const senha = document.getElementById("cadastroSenha").value;
            const confirmarSenha = document.getElementById("confirmar_senha").value;

            if (senha !== confirmarSenha) {
                Swal.fire({
                    title: "Erro!",
                    text: "As senhas não coincidem.",
                    icon: "error",
                    confirmButtonText: "OK"
                });
                return false;
            }

            Swal.fire({
                title: "Cadastrado com Sucesso!",
                icon: "success",
                confirmButtonText: "OK"
            }).then(() => {
                form.submit();
            });
        });
    });
</script>